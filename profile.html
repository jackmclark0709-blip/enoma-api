<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Profile — Enoma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f6f7f9;
      margin: 0;
      color: #111;
      line-height: 1.6;
    }

    .container {
      max-width: 780px;
      margin: 4rem auto;
      padding: 1.5rem;
    }

    .card {
      background: #ffffff;
      border-radius: 14px;
      padding: 2.5rem;
      box-shadow: 0 15px 40px rgba(0,0,0,.05);
    }

    h1 {
      font-size: 2.1rem;
      margin: 0 0 .25rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .headline {
      font-size: 1.1rem;
      opacity: .7;
      margin-bottom: 1.5rem;
    }

    .section {
      margin-top: 2.5rem;
    }

    .section h2 {
      font-size: .8rem;
      text-transform: uppercase;
      letter-spacing: .14em;
      color: #888;
      margin-bottom: .75rem;
    }

    .summary {
      font-size: 1.05rem;
      margin-bottom: 1.25rem;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem;
      margin-top: .5rem;
    }

    .badge {
      padding: .4rem .75rem;
      background: #f0f0f0;
      border-radius: 999px;
      font-size: .8rem;
      color: #444;
    }

    .timeline {
      border-left: 2px solid #eee;
      padding-left: 1.25rem;
      margin-top: 1rem;
    }

    .timeline-item {
      margin-bottom: 1.25rem;
      position: relative;
    }

    .timeline-item::before {
      content: "";
      position: absolute;
      left: -1.6rem;
      top: .25rem;
      width: .65rem;
      height: .65rem;
      border-radius: 50%;
      background: #000;
    }

    .timeline-year {
      font-weight: 600;
      font-size: .85rem;
      opacity: .6;
    }

    .links a {
      display: inline-block;
      margin-right: 1rem;
      margin-top: .5rem;
      text-decoration: none;
      font-size: .9rem;
      color: #000;
      border-bottom: 1px solid rgba(0,0,0,.2);
    }

    .footer {
      margin-top: 3rem;
      text-align: center;
      font-size: .75rem;
      opacity: .4;
    }

    .empty {
      opacity: .4;
      font-size: .9rem;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="card">

    <h1 id="displayName"></h1>
<img id="avatar" style="max-width:140px;border-radius:50%;margin-top:.75rem;" />

    <div class="headline" id="headline"></div>

    <div class="summary" id="summary"></div>

    <div class="section">
      <h2>Expertise</h2>
      <div id="expertise" class="badge-row"></div>
    </div>

    <div class="section">
      <h2>Timeline</h2>
      <div id="timeline" class="timeline"></div>
    </div>

    <div class="section">
      <h2>Links</h2>
      <div id="links" class="links"></div>
    </div>

    <div class="footer">enoma.io — structured identity</div>

  </div>
</div>

<script>
const username = location.pathname.replace("/", "").replace(".html","");

async function loadProfile(){

  if(username === "" || username === "profile") {
    const profile = JSON.parse(sessionStorage.getItem("profile"));
    return render(profile);
  }

  const res = await fetch(`/api/get-profile?username=${username}`);
  const profile = await res.json();

  render(profile);
}

function render(p) {

document.getElementById("displayName").textContent = p.display_name;
document.getElementById("headline").textContent = p.headline;
document.getElementById("summary").textContent = p.summary;

if(p.profile_image) {
  document.getElementById("avatar").src = p.profile_image;
}

// Expertise
const ex = document.getElementById("expertise");
ex.innerHTML = "";
(p.expertise || []).forEach(e=>{
  const span=document.createElement("span");
  span.className="badge";
  span.textContent=e;
  ex.appendChild(span);
});

// Timeline
const t = document.getElementById("timeline");
t.innerHTML = "";
(p.timeline || []).forEach(item=>{
  const div=document.createElement("div");
  div.className="timeline-item";
  div.innerHTML = `<div class="timeline-year">${item.year || ""}</div><div>${item.event||""}</div>`;
  t.appendChild(div);
})

// Links
const l = document.getElementById("links");
l.innerHTML = "";

Object.entries(p.social||{}).forEach(([key,url])=>{
  if(!url) return;
  const a=document.createElement("a");
  a.href=url;
  a.textContent=key;
  a.target="_blank";
  l.appendChild(a);
});
}

loadProfile();
</script>

</body>
</html>
